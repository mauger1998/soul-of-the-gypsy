---
const { projects } = Astro.props
import Project from './items/Project.astro'
---

<section class="project-grid-section">
	<div class="wrapper">
		{
			projects.map((project, index) => (
				<Project
					index={index}
					image={project.image}
					title={project.title}
					text={project.description}
				/>
			))
		}
	</div>
</section>

<script>
	import { gsap } from 'gsap'
	import { ScrollTrigger } from 'gsap/ScrollTrigger'
	gsap.registerPlugin(ScrollTrigger)

	const allProjectItems = document.querySelectorAll('.project .mask > img')
	const allProjectItemsText = document.querySelectorAll('.project > .text')

	allProjectItems.forEach((project, index) => {
		const projectText = allProjectItemsText[index]

		const tl = gsap.timeline({
			scrollTrigger: {
				trigger: project,
				start: 'top 80%',
				toggleActions: 'play none none reverse'
			}
		})

		tl.to(project, {
			clipPath: 'polygon(0 0, 100% 0, 100% 100%, 0% 100%)'
		})
			.to(
				project,
				{
					scale: 1,
					ease: 'power1.inOut'
				},
				'-=0.35'
			)
			.to(projectText, {
				opacity: 1,
				y: 0,
				duration: 0.5
			})
	})
</script>

<style lang="scss">
	.project-grid-section {
		.wrapper {
			display: grid;
			grid-template-columns: 1fr 1fr 1fr;
			gap: 12rem;
		}
	}
</style>
